<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX Risk Calculator - Denar Financial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            min-height: 100vh;
        }

        .header {
            background: #000000;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #008080;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-title {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .subtitle {
            color: #cccccc;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .calculator-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            color: #000000;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #008080;
            padding-bottom: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-group input,
        .form-group select {
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #008080;
        }

        .calculate-btn {
            background: #008080;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .calculate-btn:hover {
            background: #006666;
        }

        .results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #008080;
        }

        .risk-level {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        .risk-critical { background: #f5c6cb; color: #721c24; }

        .demo-note {
            color: #666;
            font-style: italic;
            font-size: 0.9rem;
            text-align: center;
            margin: 1rem 0;
        }

        .fx-alert-banner {
            background: linear-gradient(135deg, #008080 0%, #006666 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .fx-alert-banner a {
            color: white;
            text-decoration: underline;
            font-weight: bold;
        }

        .fx-alert-banner .close-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .container {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <img src="assets/images/logo.png" alt="Denar Financial">
                Denar Financial
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="index.html#services">Services</a></li>
                <li><a href="calculator.html">Calculator</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- FX Market Alert Banner -->
    <div id="fxAlertBanner" class="fx-alert-banner">
        <span id="fxAlertText">🔥 FX volatility elevated across major currencies - Protect your business exposure</span>
        <a href="#" onclick="document.getElementById('revenue').focus(); return false;"> Calculate your risk →</a>
        <button class="close-btn" onclick="closeBanner()" title="Close">&times;</button>
    </div>

    <div class="container">
        <h1 class="page-title">FX Risk Calculator</h1>
        <p class="subtitle">Get an instant assessment of your foreign exchange risk exposure</p>
        <p class="demo-note">(Mexican Peso exposure used for Demo purposes)</p>

        <!-- FX Risk Calculator -->
        <section class="calculator-section">
            <h2 class="section-title">Step 1: Calculate Your FX Risk Exposure</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="revenue">Annual Company Revenue (USD)</label>
                    <input type="number" id="revenue" placeholder="15000000">
                </div>

                <div class="form-group">
                    <label for="industry">Industry</label>
                    <select id="industry">
                        <option value="">Select Industry</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="retail">Retail</option>
                        <option value="technology">Technology</option>
                        <option value="services">Services</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ar">Accounts Receivable in Mexico (MXN)</label>
                    <input type="number" id="ar" placeholder="5000000">
                </div>

                <div class="form-group">
                    <label for="ap">Accounts Payable in Mexico (MXN)</label>
                    <input type="number" id="ap" placeholder="3000000">
                </div>

                <div class="form-group">
                    <label for="cash">Cash Position in Mexico (MXN)</label>
                    <input type="number" id="cash" placeholder="1000000">
                </div>

                <div class="form-group">
                    <label for="monthlyRevenue">Monthly Revenue in Mexico (MXN)</label>
                    <input type="number" id="monthlyRevenue" placeholder="2000000">
                </div>

                <div class="form-group">
                    <label for="monthlyExpenses">Monthly Expenses in Mexico (MXN)</label>
                    <input type="number" id="monthlyExpenses" placeholder="1200000">
                </div>

                <div class="form-group">
                    <label for="currentRate">Current USD/MXN Rate</label>
                    <input type="number" id="currentRate" step="0.01" value="18.45" placeholder="18.45" readonly style="background-color: #f8f9fa; color: #666;">
                    <small style="color: #666; font-size: 0.8rem;">Auto-updated from live market data</small>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateRisk()">Calculate FX Risk</button>

            <div id="riskResults" class="results" style="display: none;">
                <!-- Risk results will appear here -->
            </div>
        </section>

        <!-- ROI Calculator -->
        <section class="calculator-section">
            <h2 class="section-title">Step 2: Calculate Service ROI</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="roiExposure">Annual FX Exposure (USD)</label>
                    <input type="number" id="roiExposure" placeholder="Auto-populated from risk calculator above">
                </div>

                <div class="form-group">
                    <label for="currentHedging">Current Hedging Strategy</label>
                    <select id="currentHedging">
                        <option value="0">No hedging (0% protected)</option>
                        <option value="25">Basic hedging (25% protected)</option>
                        <option value="50">Moderate hedging (50% protected)</option>
                        <option value="75">Advanced hedging (75% protected)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="riskTolerance">Risk Tolerance</label>
                    <select id="riskTolerance">
                        <option value="conservative">Conservative (minimize risk)</option>
                        <option value="moderate">Moderate (balanced approach)</option>
                        <option value="aggressive">Aggressive (accept higher risk)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="serviceTier">Service Tier</label>
                    <select id="serviceTier">
                        <option value="500">Basic FX Dashboard ($500/month)</option>
                        <option value="1500">Standard Risk Management ($1,500/month)</option>
                        <option value="3000">Premium AI Solutions ($3,000/month)</option>
                    </select>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateROI()">Calculate ROI</button>

            <div id="roiResults" class="results" style="display: none;">
                <!-- ROI results will appear here -->
            </div>
        </section>
    </div>

    <script>
        function calculateRisk() {
            try {
                // Get input values
                const revenue = parseFloat(document.getElementById('revenue').value) || 0;
                const ar = parseFloat(document.getElementById('ar').value) || 0;
                const ap = parseFloat(document.getElementById('ap').value) || 0;
                const cash = parseFloat(document.getElementById('cash').value) || 0;
                const monthlyRevenue = parseFloat(document.getElementById('monthlyRevenue').value) || 0;
                const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
                const currentRate = parseFloat(document.getElementById('currentRate').value) || 18.45;

                // Calculate net exposure
                const netOperationalExposure = (monthlyRevenue - monthlyExpenses) * 3; // 3 months forward
                const totalMXNExposure = ar - ap + cash + netOperationalExposure;
                const netExposureUSD = totalMXNExposure / currentRate;

                // Calculate exposure as percentage of revenue
                const exposurePercent = (Math.abs(netExposureUSD) / revenue) * 100;

                // Calculate VaR (Value at Risk)
                const volatility = 0.015; // 1.5% daily volatility
                const zScore = 1.65; // 95% confidence
                const dailyVaR = Math.abs(netExposureUSD) * volatility * zScore;
                const monthlyVaR = dailyVaR * Math.sqrt(22); // 22 trading days

                // Determine risk level
                let riskLevel = 'Low';
                let riskClass = 'risk-low';
                
                if (exposurePercent > 15 || (monthlyVaR / revenue * 100) > 2) {
                    riskLevel = 'Critical';
                    riskClass = 'risk-critical';
                } else if (exposurePercent > 10 || (monthlyVaR / revenue * 100) > 1.5) {
                    riskLevel = 'High';
                    riskClass = 'risk-high';
                } else if (exposurePercent > 5 || (monthlyVaR / revenue * 100) > 1) {
                    riskLevel = 'Medium';
                    riskClass = 'risk-medium';
                }

                // Scenarios
                const scenarios = {
                    'Peso strengthens 10%': (netExposureUSD * 0.10).toFixed(0),
                    'Peso strengthens 5%': (netExposureUSD * 0.05).toFixed(0),
                    'Current rate': '0',
                    'Peso weakens 5%': (netExposureUSD * -0.05).toFixed(0),
                    'Peso weakens 10%': (netExposureUSD * -0.10).toFixed(0)
                };

                // Service recommendation
                let recommendedService = 'Basic FX Dashboard';
                if (riskLevel === 'Critical' || revenue > 50000000) {
                    recommendedService = 'Premium AI Solutions';
                } else if (riskLevel === 'High' || revenue > 20000000) {
                    recommendedService = 'Standard Risk Management';
                }

                // Display results
                const resultsDiv = document.getElementById('riskResults');
                resultsDiv.innerHTML = `
                    <h3>Your FX Risk Assessment</h3>
                    <div class="risk-level ${riskClass}">Risk Level: ${riskLevel}</div>
                    
                    <p><strong>Net FX Exposure:</strong> ${Math.abs(netExposureUSD).toLocaleString()} USD</p>
                    <p><strong>Exposure as % of Revenue:</strong> ${exposurePercent.toFixed(1)}%</p>
                    <p><strong>Monthly Value at Risk (95%):</strong> ${monthlyVaR.toLocaleString()}</p>
                    
                    <h4>Potential Impact Scenarios:</h4>
                    <ul>
                        ${Object.entries(scenarios).map(([scenario, impact]) => 
                            `<li>${scenario}: ${impact >= 0 ? '+' : ''}${Math.abs(impact).toLocaleString()}</li>`
                        ).join('')}
                    </ul>
                    
                    <p><strong>Recommended Service:</strong> ${recommendedService}</p>
                    <p><a href="mailto:consulting@denarfinancial.com?subject=FX Risk Assessment Follow-up">Schedule Free Consultation →</a></p>
                `;
                resultsDiv.style.display = 'block';

                // Auto-populate ROI calculator with the actual exposure
                document.getElementById('roiExposure').value = Math.abs(netExposureUSD).toFixed(0);
                
                // Auto-calculate ROI after a brief delay
                setTimeout(calculateROI, 500);

            } catch (error) {
                console.error('Risk calculation error:', error);
            }
        }

        function calculateROI() {
            try {
                // Get values
                const exposure = parseFloat(document.getElementById('roiExposure').value) || 0;
                const hedgingPercent = parseFloat(document.getElementById('currentHedging').value) || 0;
                const riskTolerance = document.getElementById('riskTolerance').value;
                const serviceCost = parseFloat(document.getElementById('serviceTier').value) || 1500;

                if (exposure === 0) {
                    alert('Please calculate FX risk first or enter your annual FX exposure amount.');
                    return;
                }

                // Adjust volatility assumption based on risk tolerance
                let annualVolatility;
                switch(riskTolerance) {
                    case 'conservative':
                        annualVolatility = 0.08; // 8% - conservative estimate
                        break;
                    case 'moderate':
                        annualVolatility = 0.12; // 12% - moderate estimate
                        break;
                    case 'aggressive':
                        annualVolatility = 0.16; // 16% - aggressive estimate
                        break;
                    default:
                        annualVolatility = 0.12;
                }

                // Calculate potential annual loss
                const potentialLoss = exposure * annualVolatility;
                const currentProtection = potentialLoss * (hedgingPercent / 100);
                const unprotectedRisk = potentialLoss - currentProtection;

                // Calculate service benefits (adjust based on service tier)
                let riskReduction;
                switch(serviceCost) {
                    case 500:
                        riskReduction = 0.50; // Basic: 50% risk reduction
                        break;
                    case 1500:
                        riskReduction = 0.70; // Standard: 70% risk reduction
                        break;
                    case 3000:
                        riskReduction = 0.85; // Premium: 85% risk reduction
                        break;
                    default:
                        riskReduction = 0.70;
                }

                const additionalProtection = unprotectedRisk * riskReduction;
                const annualServiceCost = serviceCost * 12;

                // Calculate ROI
                const netSavings = additionalProtection - annualServiceCost;
                const roi = annualServiceCost > 0 ? ((additionalProtection - annualServiceCost) / annualServiceCost * 100) : 0;
                const paybackDays = additionalProtection > 0 ? (annualServiceCost / additionalProtection * 365) : 999;

                // Get service tier name
                const serviceTierNames = {
                    500: 'Basic FX Dashboard',
                    1500: 'Standard Risk Management', 
                    3000: 'Premium AI Solutions'
                };
                const serviceName = serviceTierNames[serviceCost];

                // Display results
                const roiResultsDiv = document.getElementById('roiResults');
                roiResultsDiv.innerHTML = `
                    <h3>ROI Analysis - ${serviceName}</h3>
                    
                    <p><strong>Risk Assessment (${riskTolerance} approach):</strong></p>
                    <ul>
                        <li>Estimated annual volatility: ${(annualVolatility * 100).toFixed(0)}%</li>
                        <li>Potential annual loss at risk: ${potentialLoss.toLocaleString()}</li>
                        <li>Current protection: ${hedgingPercent}% (saving ${currentProtection.toLocaleString()})</li>
                        <li>Remaining unprotected risk: ${unprotectedRisk.toLocaleString()}</li>
                    </ul>
                    
                    <p><strong>With Our ${serviceName}:</strong></p>
                    <ul>
                        <li>Additional risk reduction: ${(riskReduction * 100).toFixed(0)}%</li>
                        <li>Additional annual protection: ${additionalProtection.toLocaleString()}</li>
                        <li>Annual service cost: ${annualServiceCost.toLocaleString()}</li>
                        <li>Net annual savings: ${netSavings.toLocaleString()}</li>
                    </ul>
                    
                    <div style="background: ${netSavings > 0 ? '#e8f5e8' : '#fff3cd'}; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>ROI: ${roi.toFixed(0)}%</strong></p>
                        <p><strong>Payback period: ${paybackDays < 365 ? paybackDays.toFixed(0) + ' days' : 'More than 1 year'}</strong></p>
                        ${netSavings > 0 ? 
                            '<p style="color: #155724;"><strong>✓ Positive ROI - Service recommended</strong></p>' : 
                            '<p style="color: #856404;"><strong>⚠ Consider higher service tier or improve current hedging</strong></p>'
                        }
                    </div>
                    
                    <p><a href="mailto:consulting@denarfinancial.com?subject=ROI Analysis - ${serviceName}">Get Started with ${serviceName} →</a></p>
                `;
                roiResultsDiv.style.display = 'block';

            } catch (error) {
                alert('Error calculating ROI: ' + error.message);
            }
        }
    </script>

    <script>
        // FX Market Alert Banner Functions
        let fxData = null;
        let lastUpdate = 0;
        const REFRESH_INTERVAL = 7.5 * 60 * 60 * 1000; // 7.5 hours in milliseconds

        async function updateFXData() {
            try {
                const response = await fetch('https://api.fixer.io/latest?access_key=YOUR_API_KEY&base=USD&symbols=EUR,GBP,JPY,MXN,CAD,AUD');
                const data = await response.json();
                
                if (data.success) {
                    fxData = data;
                    lastUpdate = Date.now();
                    localStorage.setItem('fxData', JSON.stringify(fxData));
                    localStorage.setItem('lastUpdate', lastUpdate.toString());
                    updateBannerText();
                } else {
                    // Use fallback message if API fails
                    showFallbackBanner();
                }
            } catch (error) {
                console.log('FX API unavailable, using fallback');
                showFallbackBanner();
            }
        }

        function updateBannerText() {
            if (!fxData) return;
            
            const messages = [
                `🔥 Major currencies showing elevated volatility - USD/EUR: ${fxData.rates.EUR.toFixed(4)}`,
                `⚠️ FX markets active: GBP at ${fxData.rates.GBP.toFixed(4)}, MXN at ${fxData.rates.MXN.toFixed(2)}`,
                `📈 Currency movements accelerating across G7 pairs - Protect your exposure`,
                `💹 Live FX data: EUR ${fxData.rates.EUR.toFixed(4)} | GBP ${fxData.rates.GBP.toFixed(4)} | Active volatility detected`
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            document.getElementById('fxAlertText').innerHTML = randomMessage;
        }

        function showFallbackBanner() {
            const fallbackMessages = [
                '🔥 FX volatility elevated across major currencies - Protect your business exposure',
                '⚠️ Currency markets showing increased volatility - Calculate your risk exposure',
                '📈 Global FX uncertainty rising - Is your business protected?',
                '💹 Major currency pairs experiencing heightened volatility'
            ];
            
            const randomFallback = fallbackMessages[Math.floor(Math.random() * fallbackMessages.length)];
            document.getElementById('fxAlertText').innerHTML = randomFallback;
        }

        function closeBanner() {
            document.getElementById('fxAlertBanner').style.display = 'none';
            localStorage.setItem('bannerClosed', 'true');
        }

        function initializeBanner() {
            // Check if banner was closed by user
            if (localStorage.getItem('bannerClosed') === 'true') {
                document.getElementById('fxAlertBanner').style.display = 'none';
                return;
            }

            // Check if we have cached data
            const cachedData = localStorage.getItem('fxData');
            const cachedUpdate = localStorage.getItem('lastUpdate');
            
            if (cachedData && cachedUpdate) {
                const timeSinceUpdate = Date.now() - parseInt(cachedUpdate);
                
                if (timeSinceUpdate < REFRESH_INTERVAL) {
                    // Use cached data
                    fxData = JSON.parse(cachedData);
                    updateBannerText();
                    return;
                }
            }
            
            // Get fresh data
            updateFXData();
        }

        // Initialize banner when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeBanner();
            
            // Set up periodic refresh
            setInterval(function() {
                if (localStorage.getItem('bannerClosed') !== 'true') {
                    updateFXData();
                }
            }, REFRESH_INTERVAL);
        });
    </script>
</body>
</html>
